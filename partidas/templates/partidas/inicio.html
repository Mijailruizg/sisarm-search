{% extends "partidas/base.html" %}

{% load static %}
{% block extra_styles %}
<style>
    body.detalle-bg {
        background-image: url('{% static "img/fondo.jpg.png" %}');
        background-size: cover;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-position: center;
    }
    
    .main-menu-container { max-width: 980px; margin: 3.5rem auto; padding: 2.2rem; text-align: center; background-color: rgba(255,255,255,0.95); border-radius: 14px; box-shadow: 0 8px 34px rgba(0,0,0,0.14); z-index: 2; position: relative; }
    .main-menu-container h2 { font-size: 2.05rem; margin-bottom: 1.2rem; color: #003366; letter-spacing: 0.3px; }

    .button-grid { display: grid; grid-template-columns: repeat(3, minmax(220px, 1fr)); gap: 1rem; align-items: stretch; }

    .button-grid a { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 64px; padding: 0.9rem 1rem; text-decoration: none; background-color: #cce5ff; color: #003366; font-weight: 700; border: 0; border-radius: 10px; transition: background-color 0.18s ease, transform 0.08s ease, box-shadow 0.12s ease; box-shadow: 0 2px 6px rgba(0,0,0,0.06); font-size: 0.95rem; }
    .button-grid a:hover { background-color: #b3d7ff; transform: translateY(-3px); box-shadow: 0 6px 18px rgba(0,0,0,0.12); }
    .button-grid a:focus { outline: 3px solid rgba(0,51,102,0.12); outline-offset: 2px; }
    .button-grid a.small { min-height: 52px; font-weight: 700; }

    .button-grid a.secondary, .button-grid a.important { background-color: #cce5ff; color: #003366; }

    .texto-licencia { margin: 0 auto -2rem; max-width: 500px; text-align: center; color: #003366; font-weight: 600; background: transparent; padding: 0.45rem 0.8rem; border-radius: 8px; box-shadow: none; }

    .licencia-text { font-weight: 700; font-size: 1.05rem; margin-top: 0; }
    .licencia-normal { color: #eeeeee; } 
    .licencia-yellow { color: #d39e00; }
    .licencia-red { color: #c82333; }

    .marca-agua {
        display: block;
        position: static;
        margin: 0.6rem auto 0;
        opacity: 0.92;
        font-size: 1.05rem;
        color: #2f3b46;
        pointer-events: none;
        font-weight: 600;
        text-align: center;
        letter-spacing: 0.2px;
    }

    @media (max-width: 820px) {
        .button-grid { grid-template-columns: repeat(2, minmax(180px, 1fr)); }
    }
    
    @media (max-width: 520px) {
        .main-menu-container { margin: 1.2rem; padding: 1rem; }
        .button-grid { grid-template-columns: 1fr; gap: 0.6rem; }
        .button-grid a { min-height: 48px; padding: 0.7rem 0.8rem; font-size: 0.85rem; border-radius: 8px; }
        .main-menu-container h2 { font-size: 1.45rem; }
    }

    .chat-fixed {
        position: fixed;
        left: 50%;
        transform: translateX(-50%);
        bottom: 22px;
        background-color: #cce5ff;
        color: #003366;
        padding: 0.7rem 1.1rem;
        border-radius: 999px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.16);
        font-weight: 800;
        text-decoration: none;
        z-index: 1500;
        display: inline-flex;
        align-items: center;
        gap: 0.6rem;
        font-size: 0.9rem;
    }
    .chat-fixed:hover { background-color: #b3d7ff; transform: translateX(-50%) translateY(-3px); }
    .chat-fixed:focus { outline: 3px solid rgba(0,51,102,0.14); outline-offset: 4px; }
    
    @media (max-width: 420px) {
        .chat-fixed { bottom: 14px; padding: 0.6rem 0.9rem; font-weight: 700; font-size: 0.8rem; }
    }
</style>
{% endblock %}

{% block body_class %}detalle-bg{% endblock %}

{% block content %}

<div class="main-menu-container">
    <h2>Bienvenido a SISARM Search</h2>

    <div class="button-grid" role="navigation" aria-label="Menú principal">

        <a href="{% url 'buscar_partidas' %}">Buscar Partidas</a>
        <a href="{% url 'lista_aranceles' %}">Visualizar capítulos y partidas</a>
        <a href="{% url 'estadisticas_aranceles' %}">Estadísticas de Aranceles</a>

        <a href="{% url 'historial_buscador' %}">Historial</a>
        {% if request.user.is_staff %}
            <a href="{% url 'importar_excel' %}">Importar Excel</a>
            <a href="{% url 'manuales' %}">Manuales</a>
        {% else %}

            <a href="{% url 'manuales' %}">Manuales</a>
        {% endif %}

        <a href="{% url 'chat_asistente' %}">Chat de Ayuda</a>
    </div>
</div>


{% comment %}
    Mostrar indicador de licencia aquí, usando las mismas variables del context processor
    para evitar discrepancias entre el navbar y el texto en la página.
{% endcomment %}
{% comment %}
    Mostrar únicamente el texto de estado de la licencia con color según umbrales:
    - >5 días: fondo claro (blanco / natural)
    - 2..5 días: amarillo
    - 1 día (menos de 2): rojo
    Si la licencia está expirada (<= 0) mostrar mensaje de expirado con días absolutos.
{% endcomment %}
{% if licencia_dias_restantes is not None %}
    <div class="texto-licencia" aria-live="polite">
        {% if licencia_dias_restantes > 0 %}
            {# Mostrar conteo de días (sin fecha); el color solo cambia la letra (sin fondo) #}
            {% if licencia_dias_restantes > 5 %}
                <p class="licencia-text licencia-normal">Tu licencia expira en {{ licencia_dias_restantes }}d</p>
            {% elif licencia_dias_restantes <= 5 and licencia_dias_restantes >= 3 %}
                <p class="licencia-text licencia-yellow">Tu licencia expira en {{ licencia_dias_restantes }}d</p>
            {% else %}
                <p class="licencia-text licencia-red">Tu licencia expira en {{ licencia_dias_restantes }}d</p>
            {% endif %}
        {% else %}
            <p class="licencia-text licencia-red">Licencia expirada hace {{ licencia_dias_abs }} día{% if licencia_dias_abs != 1 %}s{% endif %}</p>
        {% endif %}
    </div>
{% endif %}
<div class="marca-agua">
    ©2025 SIS Code Creator – Para SISARM Bolivia
</div>
{% endblock %}
